# ============================================================================
# GitHub API Tool - Production Ready
# ============================================================================
# GitHub repository and issue management
# ============================================================================

id: github_api
name: "GitHub API"
type: api
description: "Interact with GitHub repositories, issues, and pull requests"
version: v1

# --------------------- METADATA ---------------------
metadata:
  created_at: "2025-11-07T00:00:00Z"
  updated_at: "2025-11-07T00:00:00Z"
  author: "System"
  category: api
  tags: [github, api, version-control, collaboration]
  status: active
  stability: stable
  documentation_url: "https://docs.github.com/en/rest"

# --------------------- CONFIGURATION ---------------------
config:
  api:
    base_url: "https://api.github.com"
    endpoint: "/repos/{owner}/{repo}"
    method: GET
    
    auth:
      type: bearer
      token: "${GITHUB_TOKEN}"
      header: "Authorization"
      prefix: "Bearer"
    
    headers:
      Accept: "application/vnd.github.v3+json"
      Content-Type: "application/json"
      User-Agent: "AgenticApp/1.0"
    
    timeout: 30
    retry_attempts: 3
    
    rate_limit:
      requests_per_hour: 5000  # GitHub's authenticated rate limit

# --------------------- INPUT SCHEMA ---------------------
input_schema:
  type: object
  properties:
    action:
      type: string
      description: "API action to perform"
      enum:
        - get_repo
        - list_repos
        - list_issues
        - create_issue
        - get_issue
        - update_issue
        - list_pulls
        - create_pull
        - search_code
        - search_repos
    
    owner:
      type: string
      description: "Repository owner (username or organization)"
    
    repo:
      type: string
      description: "Repository name"
    
    issue_number:
      type: integer
      description: "Issue or PR number"
    
    title:
      type: string
      description: "Issue/PR title"
    
    body:
      type: string
      description: "Issue/PR body"
    
    labels:
      type: array
      description: "Issue labels"
      items:
        type: string
    
    query:
      type: string
      description: "Search query"
    
    filters:
      type: object
      description: "Additional filters"
      properties:
        state:
          type: string
          enum: [open, closed, all]
        sort:
          type: string
          enum: [created, updated, comments]
        direction:
          type: string
          enum: [asc, desc]
  
  required: [action]

# --------------------- OUTPUT SCHEMA ---------------------
output_schema:
  type: object
  properties:
    success:
      type: boolean
    
    status_code:
      type: integer
    
    data:
      type: object
      description: "GitHub API response data"
      properties:
        id:
          type: integer
        name:
          type: string
        full_name:
          type: string
        description:
          type: string
        html_url:
          type: string
        created_at:
          type: string
        updated_at:
          type: string
        stargazers_count:
          type: integer
        forks_count:
          type: integer
        open_issues_count:
          type: integer
    
    metadata:
      type: object
      properties:
        execution_time_ms:
          type: integer
        rate_limit_remaining:
          type: integer
        rate_limit_reset:
          type: string

# --------------------- API INTEGRATION ---------------------
api_integration:
  backend:
    base_url: "http://localhost:8000"
    endpoints:
      create:
        path: "/tools"
        method: POST
      execute:
        path: "/tools/github_api/execute"
        method: POST
  
  frontend:
    service_functions:
      - name: "getRepo"
        endpoint: "/tools/github_api/execute"
        method: "POST"
        parameters: ["owner", "repo"]
      
      - name: "listIssues"
        endpoint: "/tools/github_api/execute"
        method: "POST"
        parameters: ["owner", "repo", "filters"]
      
      - name: "createIssue"
        endpoint: "/tools/github_api/execute"
        method: "POST"
        parameters: ["owner", "repo", "title", "body", "labels"]

# --------------------- ERROR HANDLING ---------------------
error_handling:
  retry:
    enabled: true
    max_attempts: 3
    retry_on: [rate_limit_exceeded, connection_timeout]
  
  validation:
    validate_input: true
    validate_output: true
  
  fallback:
    on_error: return_error
  
  error_codes:
    401: "Authentication required or invalid token"
    403: "Rate limit exceeded or forbidden"
    404: "Repository or resource not found"
    422: "Validation failed"

# --------------------- EXECUTION ---------------------
execution:
  async_enabled: true
  cache:
    enabled: true
    ttl_seconds: 300  # Cache for 5 minutes
  monitoring:
    enabled: true
    collect_metrics: true
  logging:
    enabled: true
    log_level: INFO

# --------------------- SECURITY ---------------------
security:
  authentication:
    required: true
    methods: [bearer_token]
  
  data_security:
    mask_credentials: true
    sanitize_input: true

# --------------------- EXAMPLES ---------------------
examples:
  - name: "Get Repository"
    input:
      action: get_repo
      owner: "octocat"
      repo: "Hello-World"
    expected_output:
      success: true
      status_code: 200
  
  - name: "List Open Issues"
    input:
      action: list_issues
      owner: "octocat"
      repo: "Hello-World"
      filters:
        state: open
        sort: created
        direction: desc
  
  - name: "Create Issue"
    input:
      action: create_issue
      owner: "octocat"
      repo: "Hello-World"
      title: "Found a bug"
      body: "Description of the bug"
      labels: ["bug", "high-priority"]
  
  - name: "Search Repositories"
    input:
      action: search_repos
      query: "machine learning language:python"
      filters:
        sort: stars
        direction: desc
