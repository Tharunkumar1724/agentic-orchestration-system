# Finance & Investment Tools - Portfolio Management & Analysis
# Tools for market research, portfolio analysis, risk assessment, and investment recommendations

portfolio_analyzer:
  name: "portfolio_analyzer"
  description: "Analyzes investment portfolio performance, allocation, and risk metrics"
  parameters:
    portfolio_id:
      type: "string"
      description: "Portfolio identifier"
      required: true
    analysis_type:
      type: "string"
      description: "Type: performance, allocation, risk, diversification"
      required: false
      default: "performance"
  implementation: |
    def portfolio_analyzer(portfolio_id, analysis_type="performance"):
        """Analyzes investment portfolio"""
        import random
        
        # Portfolio holdings
        holdings = {
            "stocks": round(random.uniform(40, 70), 2),
            "bonds": round(random.uniform(15, 30), 2),
            "real_estate": round(random.uniform(5, 15), 2),
            "commodities": round(random.uniform(2, 10), 2),
            "cash": round(random.uniform(3, 10), 2)
        }
        
        # Normalize to 100%
        total = sum(holdings.values())
        holdings = {k: round((v/total)*100, 2) for k, v in holdings.items()}
        
        result = {
            "portfolio_id": portfolio_id,
            "analysis_type": analysis_type,
            "total_value": round(random.uniform(50000, 5000000), 2)
        }
        
        if analysis_type == "performance":
            result["performance"] = {
                "ytd_return": round(random.uniform(-10, 25), 2),
                "1_year_return": round(random.uniform(-5, 30), 2),
                "3_year_return": round(random.uniform(5, 40), 2),
                "5_year_return": round(random.uniform(8, 50), 2),
                "since_inception": round(random.uniform(10, 80), 2),
                "benchmark_comparison": {
                    "portfolio_return": round(random.uniform(8, 15), 2),
                    "sp500_return": round(random.uniform(7, 14), 2),
                    "outperformance": round(random.uniform(-2, 5), 2)
                },
                "best_performing_asset": random.choice(list(holdings.keys())),
                "worst_performing_asset": random.choice(list(holdings.keys()))
            }
            
        elif analysis_type == "allocation":
            result["allocation"] = {
                "current_allocation": holdings,
                "target_allocation": {
                    "stocks": 60,
                    "bonds": 25,
                    "real_estate": 10,
                    "commodities": 3,
                    "cash": 2
                },
                "rebalancing_needed": random.choice([True, False]),
                "suggested_trades": [
                    {"action": "BUY", "asset": "bonds", "amount": 5000},
                    {"action": "SELL", "asset": "stocks", "amount": 3000}
                ] if random.choice([True, False]) else [],
                "sector_allocation": {
                    "Technology": round(random.uniform(15, 30), 2),
                    "Healthcare": round(random.uniform(10, 20), 2),
                    "Finance": round(random.uniform(10, 20), 2),
                    "Energy": round(random.uniform(5, 15), 2),
                    "Consumer": round(random.uniform(10, 20), 2),
                    "Other": round(random.uniform(5, 15), 2)
                }
            }
            
        elif analysis_type == "risk":
            result["risk"] = {
                "risk_score": random.randint(1, 10),
                "risk_level": random.choice(["LOW", "MODERATE", "HIGH"]),
                "volatility": round(random.uniform(5, 25), 2),
                "sharpe_ratio": round(random.uniform(0.5, 2.5), 2),
                "beta": round(random.uniform(0.7, 1.3), 2),
                "max_drawdown": round(random.uniform(-5, -20), 2),
                "var_95": round(random.uniform(-3, -8), 2),  # Value at Risk
                "risk_factors": [
                    "Market volatility exposure",
                    "Sector concentration in Technology",
                    "Interest rate sensitivity"
                ][:random.randint(1, 3)]
            }
            
        elif analysis_type == "diversification":
            result["diversification"] = {
                "diversification_score": random.randint(60, 95),
                "asset_class_spread": len(holdings),
                "geographic_distribution": {
                    "North America": round(random.uniform(40, 70), 2),
                    "Europe": round(random.uniform(10, 25), 2),
                    "Asia": round(random.uniform(10, 25), 2),
                    "Emerging Markets": round(random.uniform(5, 15), 2)
                },
                "correlation_matrix": "Low correlation between asset classes",
                "concentration_risk": random.choice(["LOW", "MODERATE", "HIGH"]),
                "recommendations": [
                    "Consider adding international exposure",
                    "Reduce concentration in top 3 holdings",
                    "Add alternative investments"
                ][:random.randint(1, 3)]
            }
        
        return result

market_research:
  name: "market_research"
  description: "Provides market research data including trends, news, and sentiment analysis"
  parameters:
    symbol:
      type: "string"
      description: "Stock ticker symbol or market index"
      required: true
    research_type:
      type: "string"
      description: "Type: price, sentiment, news, technical, fundamental"
      required: false
      default: "price"
  implementation: |
    def market_research(symbol, research_type="price"):
        """Provides market research and analysis"""
        import random
        
        result = {
            "symbol": symbol.upper(),
            "research_type": research_type,
            "timestamp": "2025-11-11T10:30:00Z"
        }
        
        if research_type == "price":
            current_price = round(random.uniform(50, 500), 2)
            result["price_data"] = {
                "current_price": current_price,
                "open": round(current_price * random.uniform(0.98, 1.02), 2),
                "high": round(current_price * random.uniform(1.00, 1.05), 2),
                "low": round(current_price * random.uniform(0.95, 1.00), 2),
                "volume": random.randint(1000000, 50000000),
                "change": round(random.uniform(-5, 5), 2),
                "change_percent": round(random.uniform(-3, 3), 2),
                "52_week_high": round(current_price * random.uniform(1.1, 1.5), 2),
                "52_week_low": round(current_price * random.uniform(0.5, 0.9), 2),
                "market_cap": f"${random.randint(1, 500)}B"
            }
            
        elif research_type == "sentiment":
            result["sentiment"] = {
                "overall_sentiment": random.choice(["BULLISH", "BEARISH", "NEUTRAL"]),
                "sentiment_score": round(random.uniform(-1, 1), 2),
                "analyst_ratings": {
                    "buy": random.randint(5, 20),
                    "hold": random.randint(3, 15),
                    "sell": random.randint(0, 5)
                },
                "social_media_sentiment": round(random.uniform(0, 100), 2),
                "institutional_activity": random.choice(["ACCUMULATING", "DISTRIBUTING", "NEUTRAL"]),
                "insider_trading": random.choice(["BUYING", "SELLING", "NO_ACTIVITY"]),
                "confidence_level": random.randint(60, 95)
            }
            
        elif research_type == "news":
            news_headlines = [
                f"{symbol} announces quarterly earnings beat",
                f"Analysts upgrade {symbol} to buy rating",
                f"{symbol} launches new product line",
                f"Market volatility affects {symbol} trading",
                f"{symbol} reports strong revenue growth"
            ]
            
            result["news"] = {
                "recent_headlines": random.sample(news_headlines, 3),
                "news_sentiment": random.choice(["POSITIVE", "NEGATIVE", "MIXED"]),
                "key_events": [
                    {"date": "2025-11-15", "event": "Earnings Report"},
                    {"date": "2025-12-01", "event": "Investor Conference"},
                    {"date": "2025-12-20", "event": "Product Launch"}
                ][:random.randint(1, 3)],
                "analyst_notes": f"Recent developments suggest {random.choice(['strong', 'moderate', 'weak'])} momentum"
            }
            
        elif research_type == "technical":
            result["technical"] = {
                "trend": random.choice(["UPTREND", "DOWNTREND", "SIDEWAYS"]),
                "support_levels": [
                    round(random.uniform(100, 200), 2),
                    round(random.uniform(80, 100), 2)
                ],
                "resistance_levels": [
                    round(random.uniform(220, 250), 2),
                    round(random.uniform(250, 300), 2)
                ],
                "indicators": {
                    "rsi": round(random.uniform(30, 70), 2),
                    "macd": random.choice(["BULLISH", "BEARISH"]),
                    "moving_avg_50": round(random.uniform(180, 220), 2),
                    "moving_avg_200": round(random.uniform(150, 200), 2)
                },
                "patterns": random.sample([
                    "Head and Shoulders",
                    "Double Bottom",
                    "Ascending Triangle",
                    "Flag Pattern"
                ], 2)
            }
            
        elif research_type == "fundamental":
            result["fundamental"] = {
                "pe_ratio": round(random.uniform(10, 40), 2),
                "eps": round(random.uniform(2, 20), 2),
                "revenue": f"${random.randint(1, 100)}B",
                "profit_margin": round(random.uniform(5, 30), 2),
                "roe": round(random.uniform(8, 25), 2),
                "debt_to_equity": round(random.uniform(0.2, 1.5), 2),
                "dividend_yield": round(random.uniform(0, 5), 2),
                "peg_ratio": round(random.uniform(0.5, 3), 2),
                "valuation": random.choice(["UNDERVALUED", "FAIRLY_VALUED", "OVERVALUED"])
            }
        
        return result

risk_assessor:
  name: "risk_assessor"
  description: "Assesses investment risk across different scenarios and time horizons"
  parameters:
    investment_amount:
      type: "number"
      description: "Investment amount in USD"
      required: true
    risk_tolerance:
      type: "string"
      description: "Risk tolerance: conservative, moderate, aggressive"
      required: false
      default: "moderate"
    time_horizon:
      type: "number"
      description: "Investment time horizon in years"
      required: false
      default: 5
  implementation: |
    def risk_assessor(investment_amount, risk_tolerance="moderate", time_horizon=5):
        """Assesses investment risk"""
        import random
        
        # Risk profiles
        risk_profiles = {
            "conservative": {
                "expected_return": 5,
                "volatility": 8,
                "max_loss_pct": -10,
                "recommended_allocation": {"stocks": 30, "bonds": 60, "cash": 10}
            },
            "moderate": {
                "expected_return": 8,
                "volatility": 12,
                "max_loss_pct": -20,
                "recommended_allocation": {"stocks": 60, "bonds": 30, "cash": 10}
            },
            "aggressive": {
                "expected_return": 12,
                "volatility": 18,
                "max_loss_pct": -30,
                "recommended_allocation": {"stocks": 85, "bonds": 10, "cash": 5}
            }
        }
        
        profile = risk_profiles.get(risk_tolerance, risk_profiles["moderate"])
        
        # Calculate projections
        expected_value = investment_amount * (1 + profile["expected_return"]/100) ** time_horizon
        best_case = investment_amount * (1 + (profile["expected_return"] + 5)/100) ** time_horizon
        worst_case = investment_amount * (1 + (profile["expected_return"] - 10)/100) ** time_horizon
        
        result = {
            "investment_amount": investment_amount,
            "risk_tolerance": risk_tolerance,
            "time_horizon_years": time_horizon,
            "risk_profile": {
                "expected_annual_return": profile["expected_return"],
                "expected_volatility": profile["volatility"],
                "maximum_drawdown": profile["max_loss_pct"],
                "risk_score": {"conservative": 3, "moderate": 6, "aggressive": 9}[risk_tolerance]
            },
            "projections": {
                "expected_value": round(expected_value, 2),
                "best_case_scenario": round(best_case, 2),
                "worst_case_scenario": round(worst_case, 2),
                "expected_gain": round(expected_value - investment_amount, 2),
                "expected_gain_pct": round(((expected_value - investment_amount) / investment_amount) * 100, 2)
            },
            "recommended_allocation": profile["recommended_allocation"],
            "risk_factors": [
                "Market volatility",
                "Economic recession risk",
                "Interest rate changes",
                "Inflation impact",
                "Geopolitical events"
            ][:random.randint(2, 5)],
            "recommendations": [
                f"Diversify across {len(profile['recommended_allocation'])} asset classes",
                f"Rebalance portfolio {'quarterly' if risk_tolerance == 'aggressive' else 'semi-annually'}",
                "Consider tax-advantaged accounts",
                "Maintain emergency fund separate from investments",
                f"Review strategy {'annually' if time_horizon > 3 else 'semi-annually'}"
            ]
        }
        
        return result

investment_recommender:
  name: "investment_recommender"
  description: "Provides personalized investment recommendations based on goals and constraints"
  parameters:
    goal:
      type: "string"
      description: "Investment goal: retirement, education, wealth_building, income"
      required: true
    available_capital:
      type: "number"
      description: "Available capital to invest"
      required: true
    age:
      type: "number"
      description: "Investor age"
      required: false
      default: 35
  implementation: |
    def investment_recommender(goal, available_capital, age=35):
        """Provides investment recommendations"""
        import random
        
        # Calculate time horizon based on goal and age
        if goal == "retirement":
            time_horizon = max(65 - age, 5)
        elif goal == "education":
            time_horizon = random.randint(10, 18)
        else:
            time_horizon = random.randint(5, 15)
        
        # Determine risk tolerance based on age and time horizon
        if age < 35 and time_horizon > 10:
            risk_level = "aggressive"
        elif age < 50 and time_horizon > 5:
            risk_level = "moderate"
        else:
            risk_level = "conservative"
        
        # Generate recommendations
        recommendations = []
        
        if goal == "retirement":
            recommendations = [
                {
                    "type": "401(k) Max Contribution",
                    "allocation": min(available_capital * 0.15, 23000),
                    "description": "Maximize employer match and tax benefits",
                    "priority": "HIGH"
                },
                {
                    "type": "IRA Contribution",
                    "allocation": min(available_capital * 0.10, 7000),
                    "description": "Additional tax-advantaged retirement savings",
                    "priority": "HIGH"
                },
                {
                    "type": "Index Funds",
                    "allocation": available_capital * 0.50,
                    "description": "Low-cost diversified equity exposure",
                    "priority": "MEDIUM"
                },
                {
                    "type": "Bond Funds",
                    "allocation": available_capital * 0.25,
                    "description": "Stability and income generation",
                    "priority": "MEDIUM"
                }
            ]
        elif goal == "education":
            recommendations = [
                {
                    "type": "529 Plan",
                    "allocation": available_capital * 0.60,
                    "description": "Tax-free growth for education expenses",
                    "priority": "HIGH"
                },
                {
                    "type": "Target Date Funds",
                    "allocation": available_capital * 0.30,
                    "description": "Automatically adjusts risk over time",
                    "priority": "MEDIUM"
                },
                {
                    "type": "Savings Bonds",
                    "allocation": available_capital * 0.10,
                    "description": "Safe, guaranteed returns",
                    "priority": "LOW"
                }
            ]
        elif goal == "wealth_building":
            recommendations = [
                {
                    "type": "Growth Stocks",
                    "allocation": available_capital * 0.40,
                    "description": "High-growth potential companies",
                    "priority": "HIGH"
                },
                {
                    "type": "Real Estate Investment Trusts",
                    "allocation": available_capital * 0.20,
                    "description": "Real estate exposure with liquidity",
                    "priority": "MEDIUM"
                },
                {
                    "type": "International Funds",
                    "allocation": available_capital * 0.20,
                    "description": "Global diversification",
                    "priority": "MEDIUM"
                },
                {
                    "type": "Alternative Investments",
                    "allocation": available_capital * 0.20,
                    "description": "Commodities, crypto (small allocation)",
                    "priority": "LOW"
                }
            ]
        else:  # income
            recommendations = [
                {
                    "type": "Dividend Stocks",
                    "allocation": available_capital * 0.40,
                    "description": "Consistent dividend payments",
                    "priority": "HIGH"
                },
                {
                    "type": "Corporate Bonds",
                    "allocation": available_capital * 0.30,
                    "description": "Regular interest income",
                    "priority": "HIGH"
                },
                {
                    "type": "REITs",
                    "allocation": available_capital * 0.20,
                    "description": "Real estate dividend income",
                    "priority": "MEDIUM"
                },
                {
                    "type": "Preferred Stocks",
                    "allocation": available_capital * 0.10,
                    "description": "Fixed dividend payments",
                    "priority": "LOW"
                }
            ]
        
        result = {
            "goal": goal,
            "available_capital": available_capital,
            "investor_age": age,
            "time_horizon_years": time_horizon,
            "risk_level": risk_level,
            "recommendations": recommendations,
            "implementation_plan": {
                "month_1": "Open accounts and make initial contributions",
                "month_2_3": "Dollar-cost average into positions",
                "month_4_6": "Monitor and adjust as needed",
                "ongoing": "Rebalance quarterly, review annually"
            },
            "expected_returns": {
                "conservative_estimate": round(available_capital * (1.05 ** time_horizon), 2),
                "moderate_estimate": round(available_capital * (1.08 ** time_horizon), 2),
                "aggressive_estimate": round(available_capital * (1.12 ** time_horizon), 2)
            },
            "tax_considerations": [
                "Maximize tax-advantaged accounts first",
                "Consider tax-loss harvesting",
                "Hold investments > 1 year for long-term capital gains",
                "Consult with tax professional"
            ]
        }
        
        return result
